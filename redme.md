**球球大作战仿制版**

**当前游戏实现的功能如下**

1. 球球大作战的自由模式
   * 玩家可以吃彩豆来增加体积
   * 玩家可以吐孢子
   * 玩家可以分身
   * 玩家和小于自身体质80%的敌人球体进行重叠时可以吞噬地方，反之则被敌人吞噬
   * 玩家最多可以可以持有16个球体，玩家分身优先从质量最大的球体开始，球体分身需要满足最低质量40分

2. 方向轮盘
   * 可以识别方向和比率，比例可以用来调整距离或速度

3. ai的实现
   * 敌人随机出现在屏幕上
   * 敌人100分以下时，会优先吃彩豆
   * 敌人100分以上时，会优先朝着小于自身的最近的敌方球体移动
   * 敌人会有一个定时器，每个时间段都很给出一个决策，比如分身决策，吐孢子决策等等（每一段时候更改一次决策，此处暂定是1秒，【分身（满足分身条件）、吃一个球（满足吃球条件）、聚球（有多个球体时），吐一个球，什么都不做】平分概率，当上一个动作未结束时不会进行下一个动作）
   * 敌人每一段时间会进行一次移动的方向判定（每一段时间更改一次移动方向）

4. 项目规范

   代码风格统一，使用统一的命名规则，变量名尽量短，函数名尽量描述功能，注释清晰，易于理解

  * 所有文件名使用`小写+下划线`命名
  * 函数、变量名使用`小驼峰`命名
  * 枚举、常量使用全`大写+下划线`命名
  * 类使用`大驼峰`命名
  * 接口使用大写字母`I`打头的大驼峰命名
  * 自定义类型使用大写字母`T`打头的大驼峰命名

  * 代码缩进统一为`2个空格`
  * 项目中尽量使用代码来管理场景，而不是在编辑器中绑定
  * 使用`单引号`定义字符串
  * 使用`Object.create(null)` 创建对象，而不是直接使用`{}`
  * 使用`[]`创建数组，不要使用`new Array()`
  * 尽量使用`===和!==`来比较变量，不要使用==和!=

5. 项目架构

   * assets
     * resources => 存放游戏资源
     * scripts => 存放游戏脚本
       * util => 存放游戏脚本工具类
       * data => 存放游戏数据
       * component => 存放游戏组件
       * model => 存放游戏模型
       * manager => 存放游戏管理器
     * scenes => 存放游戏场景

6. 项目需要注意的细节

   * 玩家分身时的视野问题
     * 玩家分身时，视野肯定会变大，因此视野不能绑定到玩家的球体上
     * 玩家分身产生多个球体，使用一个矩形将这些球体包裹起来，此时这个矩形的中心位置就算摄像机的位置，下面分析摄像机视口的大小如何计算
       * 首先当玩家只有一个球体时，摄像机的左右两个边缘的距离是固定的，假设球体边缘到屏幕边缘的地图像素距离为`x`,上下距离为`y`，设定的最小距离为`z`
       * 当摄像机需要进行视口缩放时，先获取矩形的大小`kx`,`ky`，然后获取最大比例的最大值`Math.max(y / ky, x / kx) as k`，此时视口大小分别缩放k倍
       * 此时视口和和矩形至少有一边重合，将重合的这条边增加最小距离`2z`，然后按照比例缩放得到最终视口大小
       * 计算公式如下
         ```ts
         // 初始视口大小
         const size = v2(1920, 1080)
         // 获取的矩形大小
         const rectSize = v2(100, 100)
         // 求最大的比率
         let k = 0
         if(rectSize.x > rectSize.y) {
           k = rectSize.x + z * 2 / size.x
         } else {
           k = rectSize.y + z * 2 / size.y
         }
         // 视口的最终大小
         const viewport = v2(size.x * k, size.y * k)

         ```
       * 实际上，由于视口不能直接调整大小（屏幕大小是固定的，且游戏视角是全屏的），因此在获取到最终的缩放比例后，直接缩放摄像机视口大小即可

7. 笔记

* 在使用`Sprite`组件时，应该先添加`UITransform`组件，否则后续更改大小时不会生效